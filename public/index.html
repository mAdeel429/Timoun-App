 <!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>React App</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&amp;display=swap" rel="stylesheet">
  
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>  -->


<!doctype html>
<html lang="en" class="h-full">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#FFF5E6">
  <title>Timoun</title>
  <link rel="manifest" href="data:application/json,{}">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Nunito', sans-serif;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      overscroll-behavior: none;
    }

    * {
      -webkit-touch-callout: none;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-8px);
      }
    }

    @keyframes pulse-soft {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.03);
      }
    }

    @keyframes bounce-in {
      0% {
        transform: scale(0.3);
        opacity: 0;
      }

      50% {
        transform: scale(1.05);
      }

      70% {
        transform: scale(0.9);
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes wiggle {

      0%,
      100% {
        transform: rotate(0deg);
      }

      25% {
        transform: rotate(-3deg);
      }

      75% {
        transform: rotate(3deg);
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      20%,
      60% {
        transform: translateX(-10px);
      }

      40%,
      80% {
        transform: translateX(10px);
      }
    }

    @keyframes confetti-fall {
      0% {
        transform: translateY(-100%) rotate(0deg);
        opacity: 1;
      }

      100% {
        transform: translateY(100%) rotate(720deg);
        opacity: 0;
      }
    }

    @keyframes sparkle {

      0%,
      100% {
        opacity: 0;
        transform: scale(0);
      }

      50% {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes music-note-float {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }

      100% {
        transform: translateY(-60px) rotate(15deg);
        opacity: 0;
      }
    }

    @keyframes glow-pulse {

      0%,
      100% {
        box-shadow: 0 0 20px rgba(255, 182, 193, 0.4);
      }

      50% {
        box-shadow: 0 0 40px rgba(255, 182, 193, 0.8);
      }
    }

    @keyframes bar-dance {

      0%,
      100% {
        height: 20%;
      }

      50% {
        height: 100%;
      }
    }

    .float-animation {
      animation: float 3s ease-in-out infinite;
    }

    .pulse-animation {
      animation: pulse-soft 2s ease-in-out infinite;
    }

    .bounce-in {
      animation: bounce-in 0.6s ease-out forwards;
    }

    .wiggle {
      animation: wiggle 0.5s ease-in-out;
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }

    .glow-pulse {
      animation: glow-pulse 2s ease-in-out infinite;
    }

    .confetti-piece {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: confetti-fall 2s ease-out forwards;
    }

    .sparkle {
      position: absolute;
      font-size: 24px;
      animation: sparkle 0.8s ease-out forwards;
    }

    .music-note {
      position: absolute;
      font-size: 28px;
      animation: music-note-float 2s ease-out forwards;
      pointer-events: none;
    }

    .visualizer-bar {
      animation: bar-dance 0.5s ease-in-out infinite;
    }

    .tap-feedback:active {
      transform: scale(0.95);
      transition: transform 0.1s ease;
    }

    .menu-tile {
      transition: all 0.2s ease;
    }

    .menu-tile:active {
      transform: scale(0.92);
    }

    .video-card:active,
    .song-card:active {
      transform: scale(0.96);
    }

    .screen {
      position: absolute;
      inset: 0;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .screen-hidden {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.95);
    }

    .gradient-warm {
      background: linear-gradient(145deg, #FFF5E6 0%, #FFE4D6 50%, #FFDAB9 100%);
    }

    .gradient-sky {
      background: linear-gradient(145deg, #E6F3FF 0%, #D4ECFF 50%, #B8E0FF 100%);
    }

    .gradient-mint {
      background: linear-gradient(145deg, #E8FFF0 0%, #D4F5E0 50%, #B8EED0 100%);
    }

    .gradient-lavender {
      background: linear-gradient(145deg, #F5E6FF 0%, #ECD9FF 50%, #E0CCFF 100%);
    }

    .safe-area {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }

    .keypad-btn:active {
      transform: scale(0.88);
    }

    #menu-bear {
  position: absolute;

  /* bottom-right companion placement */
  right: max(12px, env(safe-area-inset-right));
  bottom: max(12px, env(safe-area-inset-bottom));

  /* responsive sizing */
  width: 22vw;
  max-width: 160px;   /* iPad / big screens */
  min-width: 90px;    /* small iPhones */

  opacity: 0.95;
}

@media (min-width: 900px) {
  #menu-bear {
    width: 18vw;
    max-width: 220px;
  }
}

#login-bear {
  display: flex;
  justify-content: center;
  align-items: center;
}

.login-bear-img {
  display: block;
  margin-left: auto;
  margin-right: auto;

  width: 28vw;
  max-width: 220px;
  min-width: 120px;
}

/* very small phones */
@media (max-width: 380px) {
  #menu-bear {
    width: 28vw;
    min-width: 80px;
  }
}
.login-bear-img {
  width: 28vw;      
  max-width: 220px;   
  min-width: 120px;   
}

/* very small phones */
@media (max-width: 380px) {
  .login-bear-img {
    width: 36vw;
    min-width: 100px;
  }
}

/* large tablets / iPad */
@media (min-width: 900px) {
  .login-bear-img {
    width: 22vw;
    max-width: 260px;
  }
}

  </style>
  <style>
    @view-transition {
      navigation: auto;
    }
  </style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>

<body class="h-full overflow-auto gradient-warm safe-area">
  <div id="app" class="h-full w-full relative overflow-hidden"><!-- Login Screen -->
    <div id="login-screen" class="screen gradient-warm flex flex-col items-center justify-center p-6">
      <div class="text-center mb-10 relative">
        <div id="login-bear" class="mb-6 float-animation pulse-animation">
  <img src="./4.png"
       alt="Bear Character"
       class="login-bear-img"
       draggable="false" />
</div>

        <h1 id="app-title-display" class="text-5xl font-black text-amber-600 tracking-wide bounce-in">Timoun</h1>
        <p class="text-amber-500 mt-2 text-lg font-semibold">Parent Access</p>
      </div><!-- PIN Display -->
      <div id="pin-display" class="flex gap-6 mb-10">
        <div class="pin-dot w-7 h-7 rounded-full bg-amber-200 transition-all duration-300"></div>
        <div class="pin-dot w-7 h-7 rounded-full bg-amber-200 transition-all duration-300"></div>
        <div class="pin-dot w-7 h-7 rounded-full bg-amber-200 transition-all duration-300"></div>
        <div class="pin-dot w-7 h-7 rounded-full bg-amber-200 transition-all duration-300"></div>
      </div><!-- Keypad -->
      <div id="keypad" class="grid grid-cols-3 gap-3 max-w-xs w-full"><button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="1">1</button> <button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="2">2</button> <button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="3">3</button> <button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="4">4</button> <button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="5">5</button> <button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="6">6</button> <button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="7">7</button> <button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="8">8</button> <button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="9">9</button>
        <div></div><button
          class="keypad-btn tap-feedback h-20 rounded-3xl bg-white/80 shadow-lg text-3xl font-bold text-amber-600 hover:bg-white"
          data-num="0">0</button> <button id="clear-btn"
          class="tap-feedback h-20 rounded-3xl bg-rose-100 shadow-lg text-2xl font-bold text-rose-400 hover:bg-rose-200">‚úï</button>
      </div><!-- Confetti Container -->
      <div id="confetti-container" class="fixed inset-0 pointer-events-none overflow-hidden"></div>
    </div><!-- Main Menu Screen -->
    <div id="menu-screen" class="screen screen-hidden gradient-sky flex flex-col p-6">
      <div class="text-center mb-6">
        <h1 id="menu-title" class="text-3xl font-black text-sky-600">Let's Play!</h1>
        <div class="flex justify-center gap-2 mt-2"><span class="text-2xl wiggle inline-block"
            style="animation-delay: 0s">‚≠ê</span> <span class="text-2xl wiggle inline-block"
            style="animation-delay: 0.1s">üåà</span> <span class="text-2xl wiggle inline-block"
            style="animation-delay: 0.2s">‚≠ê</span>
        </div>
      </div>
      <div class="flex-1 grid grid-cols-2 gap-4 content-center max-w-md mx-auto w-full"><!-- Watch! Tile --> <button
          id="watch-btn"
          class="menu-tile pulse-animation col-span-1 aspect-square rounded-3xl bg-gradient-to-br from-rose-300 to-rose-400 shadow-xl flex flex-col items-center justify-center p-4 border-4 border-white/50">
          <div class="text-5xl mb-2">
            üì∫
          </div><span class="text-white font-bold text-lg drop-shadow">Watch!</span>
        </button> <!-- Tiny Tunes Tile --> <button id="tunes-btn"
          class="menu-tile pulse-animation col-span-1 aspect-square rounded-3xl bg-gradient-to-br from-violet-300 to-violet-400 shadow-xl flex flex-col items-center justify-center p-4 border-4 border-white/50"
          style="animation-delay: 0.2s">
          <div class="text-5xl mb-2">
            üéµ
          </div><span class="text-white font-bold text-lg drop-shadow">Tiny Tunes</span>
        </button> <!-- Learn & Play (Locked) --> <button
          class="menu-tile col-span-1 aspect-square rounded-3xl bg-gradient-to-br from-emerald-200 to-emerald-300 shadow-lg flex flex-col items-center justify-center p-4 border-4 border-white/30 opacity-60 relative overflow-hidden"
          disabled>
          <div class="text-5xl mb-2 grayscale-[30%]">
            üéÆ
          </div><span class="text-emerald-700/70 font-bold text-lg">Learn &amp; Play</span>
          <div class="absolute top-3 right-3 text-xl">
            üîí
          </div>
        </button> <!-- Piano Pal (Locked) --> <button
          class="menu-tile col-span-1 aspect-square rounded-3xl bg-gradient-to-br from-amber-200 to-amber-300 shadow-lg flex flex-col items-center justify-center p-4 border-4 border-white/30 opacity-60 relative overflow-hidden"
          disabled>
          <div class="text-5xl mb-2 grayscale-[30%]">
            üéπ
          </div><span class="text-amber-700/70 font-bold text-lg">Piano Pal</span>
          <div class="absolute top-3 right-3 text-xl">
            üîí
          </div>
        </button> <!-- A-B-C-D (Locked) --> <button
          class="menu-tile col-span-2 h-28 rounded-3xl bg-gradient-to-br from-cyan-200 to-cyan-300 shadow-lg flex flex-col items-center justify-center p-4 border-4 border-white/30 opacity-60 relative overflow-hidden"
          disabled>
          <div class="text-5xl mb-1 grayscale-[30%]">
            üî§
          </div><span class="text-cyan-700/70 font-bold text-lg">A-B-C-D</span>
          <div class="absolute top-3 right-3 text-xl">
            üîí
          </div>
        </button>
      </div><!-- Exit Button (Parent) -->
      <!-- Bear Character -->
<div id="menu-bear" class="pointer-events-none float-animation">
  <img src="./4.png" alt="Bear friend"
       class="w-full h-auto" />
</div>

      <button id="exit-btn" aria-label="Go to Home" class="tap-feedback mt-6 mx-auto
         w-16 h-16
         rounded-full
         bg-white/70
         shadow-xl
         flex items-center justify-center
         active:scale-90
         transition-transform duration-150
         select-none">
        <img src="./logo v1.png" alt="Timoun Home" class="w-12 h-auto pointer-events-none" draggable="false" />
      </button>

    </div><!-- Watch Screen (Video Gallery) -->
    <div id="watch-screen" class="screen screen-hidden gradient-mint flex flex-col"><!-- Header -->
      <div class="flex items-center p-4 bg-white/40"><button id="watch-back-btn"
          class="tap-feedback w-14 h-14 rounded-full bg-white shadow-lg flex items-center justify-center"> <span
            class="text-2xl">‚Üê</span> </button>
        <h2 class="flex-1 text-center text-2xl font-black text-emerald-600">Watch!</h2>
        <div class="w-14"></div>
      </div><!-- Video Grid -->
      <div class="flex-1 overflow-auto p-4">
        <div class="grid grid-cols-2 gap-4 max-w-md mx-auto" id="watch-grid">
        </div>
      </div>
    </div><!-- Video Player Screen -->
    <div id="player-screen" class="screen screen-hidden bg-slate-900 flex flex-col"><button id="player-back-btn"
        class="tap-feedback absolute top-4 left-4 z-10 w-14 h-14 rounded-full bg-white shadow-lg flex items-center justify-center">
        <span class="text-2xl text-black">‚Üê</span> </button>
      <div class="flex-1 flex items-center justify-center relative">
        <div id="video-display"
  class="w-full h-full relative overflow-hidden">
  
  /* <video id="video-player"
    class="absolute inset-0 w-full h-full object-cover"
    playsinline
    preload="auto">
  </video> */
  <video
  class="absolute inset-0 w-full h-full object-cover"
  id="video-player"
  playsinline
  webkit-playsinline
  preload="metadata"
>
</video>

</div>
<!-- Play/Pause Button --> <button id="play-pause-btn"
          class="tap-feedback absolute bottom-20 w-24 h-24 rounded-full bg-white shadow-2xl flex items-center justify-center">
          <span id="play-icon" class="text-4xl ml-1">‚ñ∂</span> </button>
      </div><!-- Progress Bar (Visual only) -->
      <div class="px-8 pb-8">
        <div class="h-3 bg-white/20 rounded-full overflow-hidden">
          <div id="progress-bar"
            class="h-full bg-gradient-to-r from-rose-400 to-pink-400 rounded-full transition-all duration-300"
            style="width: 0%"></div>
        </div>
      </div><!-- Celebration Overlay -->
      <div id="celebration-overlay"
        class="absolute inset-0 bg-slate-900/90 flex-col items-center justify-center hidden">
        <div class="text-8xl mb-4 bounce-in">
          üéâ
        </div>
        <p class="text-white text-3xl font-bold">Yay!</p>
        <div id="celebration-confetti" class="absolute inset-0 pointer-events-none"></div>
      </div>
    </div><!-- Tiny Tunes Screen -->
    <div id="tunes-screen" class="screen screen-hidden gradient-lavender flex flex-col"><!-- Header -->
      <div class="flex items-center p-4 bg-white/40"><button id="tunes-back-btn"
          class="tap-feedback w-14 h-14 rounded-full bg-white shadow-lg flex items-center justify-center"> <span
            class="text-2xl">‚Üê</span> </button>
        <h2 class="flex-1 text-center text-2xl font-black text-violet-600">Tiny Tunes</h2>
        <div class="w-14"></div>
      </div><!-- Now Playing -->
      <div id="now-playing" class="mx-4 mt-4 p-6 rounded-3xl bg-white/60 shadow-xl hidden">
        <div class="flex items-center gap-4">
          <div id="playing-icon"
            class="w-20 h-20 rounded-2xl bg-gradient-to-br from-violet-300 to-purple-400 flex items-center justify-center text-4xl glow-pulse">
            üåü
          </div>
          <div class="flex-1">
            <div class="text-violet-600 font-bold text-lg">
              Now Playing
            </div>
            <div id="playing-title" class="text-violet-800 font-black text-xl">
              Twinkle Star
            </div>
          </div>
        </div><!-- Visualizer -->
        <div class="flex items-end justify-center gap-1 h-12 mt-4">
          <div class="visualizer-bar w-3 bg-violet-400 rounded-full" style="animation-delay: 0s"></div>
          <div class="visualizer-bar w-3 bg-pink-400 rounded-full" style="animation-delay: 0.1s"></div>
          <div class="visualizer-bar w-3 bg-violet-400 rounded-full" style="animation-delay: 0.2s"></div>
          <div class="visualizer-bar w-3 bg-pink-400 rounded-full" style="animation-delay: 0.3s"></div>
          <div class="visualizer-bar w-3 bg-violet-400 rounded-full" style="animation-delay: 0.4s"></div>
          <div class="visualizer-bar w-3 bg-pink-400 rounded-full" style="animation-delay: 0.1s"></div>
          <div class="visualizer-bar w-3 bg-violet-400 rounded-full" style="animation-delay: 0.3s"></div>
        </div><!-- Music Notes Container -->
        <div id="music-notes-container" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
        <!-- Controls -->
        <div class="flex items-center justify-center gap-6 mt-4"><button id="prev-btn"
            class="tap-feedback w-14 h-14 rounded-full bg-violet-200 flex items-center justify-center"> <span
              class="text-2xl">‚èÆ</span> </button> <button id="music-play-btn"
            class="tap-feedback w-20 h-20 rounded-full bg-violet-500 shadow-lg flex items-center justify-center"> <span
              id="music-play-icon" class="text-3xl text-white">‚è∏</span> </button> <button id="next-btn"
            class="tap-feedback w-14 h-14 rounded-full bg-violet-200 flex items-center justify-center"> <span
              class="text-2xl">‚è≠</span> </button>
        </div>
      </div><!-- Song List -->
      <div class="flex-1 overflow-auto p-4">
        <div
    id="music-grid"
    class="grid grid-cols-2 gap-4 max-w-md mx-auto">
  </div>
       
        </div>
      </div>
    </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: 'Timoun',
      pin_code: '1234',
      background_color: '#FFF5E6',
      accent_color: '#F59E0B',
      text_color: '#92400E',
      button_color: '#FFFFFF',
      highlight_color: '#FCD34D'
    };

    let currentPin = '';
    let currentScreen = 'login';
    let isPlaying = false;
    let videoProgress = 0;
    let videoInterval = null;
    let musicPlaying = false;
    let currentSong = null;
    let musicNotesInterval = null;

    let videoPlayer = document.getElementById("video-player");

    // Sound effects with audio feedback
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playTapSound(frequency = 800, duration = 100) {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.value = frequency;
      oscillator.type = 'sine';

      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration / 1000);
    }

    function playSuccessSound() {
      // Happy ascending notes
      playTapSound(523, 100); // C
      setTimeout(() => playTapSound(659, 100), 100); // E
      setTimeout(() => playTapSound(784, 150), 200); // G
    }

    function playErrorSound() {
      // Gentle descending notes
      playTapSound(400, 150);
      setTimeout(() => playTapSound(350, 200), 150);
    }
     function playCelebrationSound() {
  const notes = [
    { freq: 523, time: 0 },    // C
    { freq: 659, time: 0.1 },  // E
    { freq: 784, time: 0.2 },  // G
    { freq: 1047, time: 0.35 } // High C (sparkle!)
  ];

  notes.forEach(n => {
    setTimeout(() => {
      playTapSound(n.freq, 140);
    }, n.time * 1000);
  });

  // Tiny pop sparkle
  setTimeout(() => playTapSound(1400, 80), 500);
}


    function playClickSound() {
      playTapSound(600, 80);
    }

    function playTapFeedback(element) {
      element.classList.add('wiggle');
      playTapSound(700, 100);
      setTimeout(() => element.classList.remove('wiggle'), 500);
    }

    function showScreen(screenId) {
  document.querySelectorAll('.screen').forEach(screen => {
    screen.classList.add('screen-hidden');
  });

  if (screenId === 'player-screen') {
    resetCelebrationOverlay();
  }

  document.getElementById(screenId).classList.remove('screen-hidden');
  currentScreen = screenId;
}


    function updatePinDisplay() {
      const dots = document.querySelectorAll('.pin-dot');
      dots.forEach((dot, index) => {
        if (index < currentPin.length) {
          dot.classList.remove('bg-amber-200');
          dot.classList.add('bg-amber-500', 'scale-125');
        } else {
          dot.classList.remove('bg-amber-500', 'scale-125');
          dot.classList.add('bg-amber-200');
        }
      });
    }

    function createConfetti() {
      const container = document.getElementById('confetti-container');
      const colors = ['#FFB6C1', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9', '#F8B500'];

      for (let i = 0; i < 50; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        piece.style.left = Math.random() * 100 + '%';
        piece.style.animationDelay = Math.random() * 0.5 + 's';
        piece.style.animationDuration = (1.5 + Math.random()) + 's';
        container.appendChild(piece);
      }

      setTimeout(() => {
        container.innerHTML = '';
      }, 3000);
    }

    function createSparkles() {
      const container = document.getElementById('confetti-container');
      const sparkles = ['‚ú®', '‚≠ê', 'üåü', 'üí´'];

      for (let i = 0; i < 15; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
        sparkle.style.left = Math.random() * 100 + '%';
        sparkle.style.top = Math.random() * 100 + '%';
        sparkle.style.animationDelay = Math.random() * 0.3 + 's';
        container.appendChild(sparkle);
      }

      setTimeout(() => {
        container.innerHTML = '';
      }, 1500);
    }

    function createMegaCelebration() {
  const container = document.getElementById('confetti-container');
  const emojis = ['üéâ','üåà','‚≠ê','‚ú®','üí´','üéà'];

  for (let i = 0; i < 40; i++) {
    const el = document.createElement('div');
    el.className = 'sparkle';
    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    el.style.left = Math.random() * 100 + '%';
    el.style.top = Math.random() * 100 + '%';
    el.style.fontSize = (30 + Math.random() * 30) + 'px';
    container.appendChild(el);
  }

  setTimeout(() => container.innerHTML = '', 2000);
}

function celebrateBear() {
  const bear = document.getElementById('login-bear');
  bear.classList.add('wiggle', 'scale-125');

  setTimeout(() => {
    bear.classList.remove('wiggle', 'scale-125');
  }, 1000);
}

    function checkPin() {
      const config = window.elementSdk?.config || defaultConfig;
      const correctPin = config.pin_code || defaultConfig.pin_code;

      if (currentPin === correctPin) {
        
        playCelebrationSound();
        createConfetti();
        createSparkles();
        createMegaCelebration();
        celebrateBear();

        setTimeout(() => {
          showScreen('menu-screen');
          currentPin = '';
          updatePinDisplay();
        }, 1500);
      } else {
        playErrorSound();
        const pinDisplay = document.getElementById('pin-display');
        pinDisplay.classList.add('shake');
        setTimeout(() => {
          pinDisplay.classList.remove('shake');
          currentPin = '';
          updatePinDisplay();
        }, 500);
      }
    }

    // Keypad handlers
    document.querySelectorAll('.keypad-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const num = e.currentTarget.dataset.num;
        if (currentPin.length < 4) {
          currentPin += num;
          playTapFeedback(e.currentTarget);
          updatePinDisplay();

          if (currentPin.length === 4) {
            setTimeout(checkPin, 300);
          }
        }
      });
    });

    document.getElementById('clear-btn').addEventListener('click', (e) => {
      currentPin = '';
      playTapFeedback(e.currentTarget);
      updatePinDisplay();
    });

    // Menu navigation
    document.getElementById('watch-btn').addEventListener('click', () => {
      playClickSound();
      showScreen('watch-screen');
    });
    document.getElementById('tunes-btn').addEventListener('click', () => {
      playClickSound();
      showScreen('tunes-screen');
    });
    document.getElementById('exit-btn').addEventListener('click', () => {
      playClickSound();
      showScreen('login-screen');
    });
    document.getElementById('watch-back-btn').addEventListener('click', () => {
      playClickSound();
      showScreen('menu-screen');
    });
    document.getElementById('tunes-back-btn').addEventListener('click', () => {
      playClickSound();
      stopMusic();
      showScreen('menu-screen');
    });
    document.getElementById("play-pause-btn").addEventListener("click", () => {

  if (isPlaying) {
    videoPlayer.pause();
    isPlaying = false;
    document.getElementById("play-icon").textContent = "‚ñ∂";
  } else {
    videoPlayer.play().catch((err) => {
  console.error('Video failed to play:', err);
});

    isPlaying = true;
    document.getElementById("play-icon").textContent = "‚è∏";
  }
});

document.getElementById("player-back-btn").addEventListener("click", () => {
  videoPlayer.pause();
  videoPlayer.currentTime = 0;
  showScreen("watch-screen");
});

const music = [
  { key: 'abc', title: 'ABC Dance', icon: 'üíÉ', file: '/music/1.mp3' },
  { key: 'abcSong', title: 'ABC Song', icon: 'üî§', file: '/music/2.mp3' },
  { key: 'bingo', title: 'Bingo', icon: 'üê∂', file: '/music/3.mp3' },
  { key: 'dad', title: 'Cool Dad', icon: 'üòé', file: '/music/4.mp3' },
  { key: 'kids', title: 'Cool Kids', icon: 'üßí', file: '/music/5.mp3' },
  { key: 'Bananas', title: 'Go Bananas', icon: 'üçå', file: '/music/6.mp3' },
  { key: 'bunnies', title: 'Little bunnies', icon: 'üê∞', file: '/music/7.mp3' },
  { key: 'life', title: 'I Love My Life', icon: '‚ù§Ô∏è', file: '/music/8.mp3' },
  { key: 'Bubble', title: 'Bubble Gum', icon: 'ü´ß', file: '/music/9.mp3' },
  { key: 'Luther', title: 'Luther', icon: 'üé§', file: '/music/10.mp3' },
  { key: 'Mutt', title: 'Mutt', icon: 'üê∂', file: '/music/11.mp3' },
  { key: 'oops', title: 'Oops', icon: 'üòÖ', file: '/music/12.mp3' },
  { key: 'ShutThum', title: 'Open, Shut Thum', icon: '‚úã', file: '/music/13.mp3' },
  { key: 'rain', title: 'Rain Go Away', icon: 'üåßÔ∏è', file: '/music/14.mp3' },
  { key: 'schoolOut', title: 'School Is Out', icon: 'üéí', file: '/music/15.mp3' },
  { key: 'SuperSiah', title: 'Super Siah', icon: 'ü¶∏‚Äç‚ôÇÔ∏è', file: '/music/16.mp3' },
  { key: 'NoNo', title: 'Thatis A NoNo', icon: 'üôÖ', file: '/music/17.mp3' },
  { key: 'tv', title: 'TV Off', icon: 'üì∫', file: '/music/19.mp3' },
  { key: 'Twinkle', title: 'Twinkle, Twinkle', icon: 'üåü', file: '/music/20.mp3' },
  { key: 'dance', title: 'Veggie Dance', icon: 'ü•ï', file: '/music/21.mp3' },
  { key: 'do', title: 'What I do', icon: 'ü§∏', file: '/music/22.mp3' }

];

const songsGrid = document.getElementById('music-grid');

music.forEach((song, index) => {
  const btn = document.createElement('button');

  btn.className = `
    song-card tap-feedback aspect-square rounded-3xl
    bg-gradient-to-br from-violet-200 to-purple-300
    shadow-xl flex flex-col items-center justify-center
    border-4 border-white/50
  `;

  btn.innerHTML = `
    <span class="text-6xl mb-2">${song.icon}</span>
    <span class="text-violet-700 font-bold">${song.title}</span>
  `;

  btn.addEventListener('click', () => playMusic(index));

  songsGrid.appendChild(btn);
});

const songs = [
  { title: "Song 1", file: "/videos/1.mp4", emoji: "üéµ" },
  { title: "Song 2", file: "/videos/2.mp4", emoji: "üé∂" },
  { title: "Song 3", file: "/videos/3.mp4", emoji: "üêª" },
  { title: "Song 4", file: "/videos/4.mp4", emoji: "‚≠ê" },
  { title: "Song 5", file: "/videos/5.mp4", emoji: "üåà" },
  { title: "Song 6", file: "/videos/6.mp4", emoji: "üéà" },
  { title: "Song 7", file: "/videos/7.mp4", emoji: "üê∏" },
  { title: "Song 8", file: "/videos/8.mp4", emoji: "üê•" },
  { title: "Song 9", file: "/videos/9.mp4", emoji: "üêº" },
  { title: "Song 10", file: "/videos/10.mp4", emoji: "ü¶ã" },
  { title: "Song 11", file: "/videos/11.mp4", emoji: "üê∞" },
  { title: "Song 12", file: "/videos/12.mp4", emoji: "üåô" },
  { title: "Song 14", file: "/videos/14.mp4", emoji: "ü¶Ü" },
  { title: "Song 15", file: "/videos/15.mp4", emoji: "üê†" }
];

// ====== CREATE CARDS ======
const watchGrid = document.getElementById("watch-grid");

songs.forEach((song, index) => {
  const btn = document.createElement("button");
  btn.className =
    "video-card tap-feedback aspect-video rounded-3xl bg-gradient-to-br from-emerald-300 to-green-400 shadow-xl flex flex-col items-center justify-center border-4 border-white/50 overflow-hidden";
  
  btn.innerHTML = `
  <span class="text-5xl mb-1">${song.emoji}</span>
`;


  btn.addEventListener("click", () => {
    playSongFile(song.file, song.title, song.emoji);
  });

  watchGrid.appendChild(btn);
});

let currentMusicIndex = null;

function playMusic(index) {
  const song = music[index];
  if (!song) return;

  currentMusicIndex = index;

  // UI
  document.getElementById('now-playing').classList.remove('hidden');
  document.getElementById('playing-icon').textContent = song.icon;
  document.getElementById('playing-title').textContent = song.title;

  // AUDIO
  audioPlayer.src = song.file;
  audioPlayer.currentTime = 0;
  audioPlayer.play();

  musicPlaying = true;
  document.getElementById('music-play-icon').textContent = '‚è∏';

  startMusicNotes();

  audioPlayer.onended = () => playNextMusic();
}

function playNextMusic() {
  if (currentMusicIndex === null) return;
  currentMusicIndex = (currentMusicIndex + 1) % music.length;
  playMusic(currentMusicIndex);
}

function playPrevMusic() {
  if (currentMusicIndex === null) return;
  currentMusicIndex =
    (currentMusicIndex - 1 + music.length) % music.length;
  playMusic(currentMusicIndex);
}


// ====== AUDIO PLAYER ======
let audioElement = new Audio();

function playSongFile(filePath, title, emoji) {

  showScreen("player-screen");


  videoPlayer.src = filePath;
  videoPlayer.play().catch((err) => {
  console.error('Video failed to play:', err);
});


  isPlaying = true;
  document.getElementById("play-icon").textContent = "‚è∏";

  videoPlayer.ontimeupdate = () => {
    let p = (videoPlayer.currentTime / videoPlayer.duration) * 100;
    document.getElementById("progress-bar").style.width = p + "%";
  };

  videoPlayer.onended = () => {
    finishVideo();
  };
}

// override video controls to use audio
function startVideo() {
  videoPlayer.play().catch((err) => {
  console.error('Video failed to play:', err);
});

  isPlaying = true;
  document.getElementById("play-icon").textContent = "‚è∏";
}

function pauseVideo() {
  videoPlayer.play().catch((err) => {
  console.error('Video failed to play:', err);
});

  isPlaying = false;
  document.getElementById("play-icon").textContent = "‚ñ∂";
}

function stopVideo() {
  videoPlayer.pause();
  videoPlayer.currentTime = 0;
  isPlaying = false;
  document.getElementById("progress-bar").style.width = "0%";
}

function resetCelebrationOverlay() {
  const overlay = document.getElementById('celebration-overlay');
  const container = document.getElementById('celebration-confetti');

  overlay.classList.add('hidden');
  overlay.classList.remove('flex');

  container.innerHTML = '';
}

    function finishVideo() {
      pauseVideo();
      playCelebrationSound();
      const overlay = document.getElementById('celebration-overlay');
      overlay.classList.remove('hidden');
      overlay.classList.add('flex');

      // Create celebration confetti
      const container = document.getElementById('celebration-confetti');
      const colors = ['#FFB6C1', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'];

      for (let i = 0; i < 30; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        piece.style.left = Math.random() * 100 + '%';
        piece.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(piece);
      }

      setTimeout(() => {
    resetCelebrationOverlay();
    stopVideo();
    showScreen('watch-screen');
  }, 2500);
    }

    let audioPlayer = new Audio();
audioPlayer.loop = false;


    // Music player
    const songData = {
  star: {
    icon: 'üî§',
    title: 'ABC Dance',
    file: '/music/1.mp3'
  },
  sheep: {
    icon: 'üêë',
    title: 'Little Lamb',
    file: '/music/2.mp3'
  },
  rain: {
    icon: 'üåßÔ∏è',
    title: 'Rain Drops',
    file: '/music/3.mp3'
  },
  frog: {
    icon: 'üê∏',
    title: 'Froggy Song',
    file: '/music/4.mp3'
  },
  sun: {
    icon: '‚òÄÔ∏è',
    title: 'Mr. Sun',
    file: '/music/5.mp3'
  },
  moon: {
    icon: 'üåô',
    title: 'Moon Night',
    file: '/music/6.mp3'
  }
};


    const songOrder = ['star', 'sheep', 'rain', 'frog', 'sun', 'moon'];

    /* document.querySelectorAll('.song-card').forEach(card => {
      card.addEventListener('click', (e) => {
        playClickSound();
        const song = e.currentTarget.dataset.song;
        playSong(song);
      });
    }); */

    function playSong(songKey) {
  const song = songData[songKey];
  if (!song) return;

  stopMusic(); // stop previous song

  currentSong = songKey;

  // UI
  document.getElementById('now-playing').classList.remove('hidden');
  document.getElementById('playing-icon').textContent = song.icon;
  document.getElementById('playing-title').textContent = song.title;

  // AUDIO
  audioPlayer.src = song.file;
  audioPlayer.currentTime = 0;
  audioPlayer.play();

  musicPlaying = true;
  document.getElementById('music-play-icon').textContent = '‚è∏';

  startMusicNotes();

  // highlight card
  document.querySelectorAll('.song-card').forEach(card => {
    card.classList.remove('glow-pulse', 'ring-4', 'ring-violet-400');
    if (card.dataset.song === songKey) {
      card.classList.add('glow-pulse', 'ring-4', 'ring-violet-400');
    }
  });

  // auto play next when finished
  audioPlayer.onended = () => {
    playNextSong();
  };
}

function playNextSong() {
  const currentIndex = songOrder.indexOf(currentSong);
  const nextIndex = (currentIndex + 1) % songOrder.length;
  playSong(songOrder[nextIndex]);
}

function playPrevSong() {
  const currentIndex = songOrder.indexOf(currentSong);
  const prevIndex = (currentIndex - 1 + songOrder.length) % songOrder.length;
  playSong(songOrder[prevIndex]);
}

    function stopMusic() {
  audioPlayer.pause();
  audioPlayer.currentTime = 0;

  musicPlaying = false;
  currentMusicIndex = null;

  document.getElementById('music-play-icon').textContent = '‚ñ∂';
  document.getElementById('now-playing').classList.add('hidden');

  clearInterval(musicNotesInterval);
  document.getElementById('music-notes-container').innerHTML = '';
}


    function startMusicNotes() {
      clearInterval(musicNotesInterval);
      const container = document.getElementById('music-notes-container');
      const notes = ['üéµ', 'üé∂', '‚ô™', '‚ô´', 'üí´'];

      musicNotesInterval = setInterval(() => {
        if (!musicPlaying) return;

        const note = document.createElement('div');
        note.className = 'music-note';
        note.textContent = notes[Math.floor(Math.random() * notes.length)];
        note.style.left = (20 + Math.random() * 60) + '%';
        note.style.bottom = '20%';
        container.appendChild(note);

        setTimeout(() => note.remove(), 2000);
      }, 500);
    }

    // Music play/pause toggle
document.getElementById('music-play-btn').addEventListener('click', () => {
  if (!audioPlayer.src) return; // no song loaded

  if (musicPlaying) {
    audioPlayer.pause();
    musicPlaying = false;
    document.getElementById('music-play-icon').textContent = '‚ñ∂';
  } else {
    audioPlayer.play();
    musicPlaying = true;
    document.getElementById('music-play-icon').textContent = '‚è∏';
  }
});



document.getElementById('next-btn').onclick = () => {
  playClickSound();
  playNextMusic();
};

document.getElementById('prev-btn').onclick = () => {
  playClickSound();
  playPrevMusic();
};

    // Element SDK integration
    async function onConfigChange(config) {
      const appTitle = config.app_title || defaultConfig.app_title;

      const titleDisplay = document.getElementById('app-title-display');
      if (titleDisplay) {
        titleDisplay.textContent = appTitle;
      }
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.accent_color || defaultConfig.accent_color,
            set: (value) => {
              config.accent_color = value;
              window.elementSdk.setConfig({ accent_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['pin_code', config.pin_code || defaultConfig.pin_code]
      ]);
    }

    // Initialize SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
  </script>
  <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9b923fc682107e32',t:'MTc2NzYwODQ5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>